<!DOCTYPE html>
<html lang="en">

<head th:replace="~{/layout/head::headFragment}"></head>

<body>

<div th:replace="~{/layout/top-bar :: top}"></div>
<div th:replace="~{/layout/navigation-bar :: nav}"></div>


<!-- Header Start -->
<div class="container-fluid bg-breadcrumb">
    <div class="container text-center py-5" style="max-width: 900px;">
        <h3 class="text-white display-3 mb-4">객실 정보 수정</h3>
        <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item"><a href="#">Pages</a></li>
            <li class="breadcrumb-item active text-white">Blog</li>
        </ol>
    </div>
</div>
<!-- Header End -->




<footer th:replace="~{/layout/footer::footerFragment}"></footer>

<!-- Back to Top -->
<a href="#" class="btn btn-primary btn-primary-outline-0 btn-md-square back-to-top"><i class="fa fa-arrow-up"></i></a>

<!-- Template Javascript -->
<script src="/js/main.js"></script>
<script>
    document.getElementById('registerForm').addEventListener('submit', function (e) {
        e.preventDefault(); // 폼의 기본 제출 동작 방지

        const formData = new FormData(this);

        ////////////////////////////////////////////////////////////////////숙소시작
        //지역 선택
        const regionSelect = document.getElementById('selectRegion'); // select 요소 가져오기
        const regionIndex = regionSelect.selectedIndex; // 선택된 옵션의 인덱스 가져오기
        const region = regionSelect.options[regionIndex].text;

        // 입력된 값을 가져옴
        const facilityAdd = document.getElementById('facilityAdd').value;

        // 쉼표를 기준으로 문자열을 분할하여 배열로 변환
        const facilityArray = facilityAdd.split(',');

        const name = formData.get('accommodationName');
        const checkIn = formData.get('checkIn');
        const checkOut = formData.get('checkOut');
        const address = formData.get('address');
        const content = formData.get('accommodationContent');

        // 체크된 숙박 시설 목록 추적
        const facilityList = [];
        const checkboxes = document.querySelectorAll('.accommodation-check-input[type=checkbox]:checked');
        checkboxes.forEach(function(checkbox) {
            if (checkbox.value !== '') {
                facilityList.push(checkbox.value);
            }
        });

        // 쉼표를 기준으로 분할한 배열을 facilityList에 추가
        facilityList.push(...facilityArray.filter(facility => facility.trim() !== ''));

        console.log(region);
        console.log(name);
        console.log(checkIn);
        console.log(checkOut);
        console.log(address);
        console.log(content);
        console.log(facilityList);

        ////////////////////////////////////////////////////////////////////숙소끝


        fetch(this.action, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: name,
                region: region,
                address: address,
                checkIn: checkIn,
                checkOut: checkOut,
                content: content,
                facilityList: facilityList
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // 요청이 성공적으로 처리되면, 여기서 UI를 업데이트하거나 페이지를 새로고침할 수 있습니다.
                alert('숙소 수정 완료되었습니다.');
                //TODO: 어디로 보내지
                window.location.href = '/';
            })
            .catch(error => {
                console.error('Error:', error);
                alert('숙소 수정 중 오류가 발생하였습니다. 입력한 정보를 확인해 주세요');
            });
    });
</script>
</body>

</html>